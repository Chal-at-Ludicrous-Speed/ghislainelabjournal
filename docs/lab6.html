<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Ghislaine de Groot" />

<meta name="date" content="2025-10-10" />

<title>lab6</title>

<script src="site_libs/header-attrs-2.29/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/navigation-1.1/sourceembed.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-6.5.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>




<style type="text/css">
#rmd-source-code {
  display: none;
}
</style>


<link rel="stylesheet" href="tweaks.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Lab Journal
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="lab1.html">Lab 1</a>
    </li>
    <li>
      <a href="lab2.html">Lab 2</a>
    </li>
    <li>
      <a href="lab3.html">Lab 3</a>
    </li>
    <li>
      <a href="lab4.html">Lab 4</a>
    </li>
    <li>
      <a href="lab5.html">Lab 5</a>
    </li>
    <li>
      <a href="lab6.html">Lab 6</a>
    </li>
    <li>
      <a href="lab6sienaexercise.html">Siena exercise</a>
    </li>
    <li>
      <a href="lab7.html">Lab 7</a>
    </li>
    <li>
      <a href="Introduction.html">Introduction</a>
    </li>
    <li>
      <a href="Theory.html">Theory</a>
    </li>
    <li>
      <a href="DataAndMethods.html">Data and Methods</a>
    </li>
    <li>
      <a href="DataPrep.html">Data Preparation</a>
    </li>
    <li>
      <a href="Analysis.html">Analysis</a>
    </li>
    <li>
      <a href="Conclusion.html">Conclusion</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://chal-at-ludicrous-speed.github.io/ghislainelabjournal/">
    <span class="fab fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
<li role="separator" class="divider"></li>
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore">lab6</h1>
<h4 class="author">Ghislaine de Groot</h4>
<h4 class="date">2025-10-10</h4>

</div>


<div id="packages" class="section level3" number="0.0.1">
<h3><span class="header-section-number">0.0.1</span> Packages</h3>
<pre class="r"><code>library(foreign)
library(tidyverse)
library(scholar) 
library(openalexR)
library(rvest) 
library(jsonlite)
library(RSiena)</code></pre>
</div>
<div id="loading-the-journal-dataset" class="section level3"
number="0.0.2">
<h3><span class="header-section-number">0.0.2</span> Loading the journal
dataset</h3>
<pre class="r"><code>sjr2022 &lt;- read_csv2(&#39;/Users/ghislaine/Downloads/Github/Social Networks/scimagojr 2022 Subject Category - Sociology and Political Science.csv&#39;)

sjr2024 &lt;- read_csv2(&#39;/Users/ghislaine/Downloads/Github/Social Networks/scimagojr 2024 Subject Category - Sociology and Political Science.csv&#39;)</code></pre>
</div>
<div
id="stealing-niels-vullings-code-and-linking-the-journals-from-sjr-to-the-journals-in-the-dataset"
class="section level1" number="1">
<h1><span class="header-section-number">1</span> Stealing Niels
Vullings’ code and linking the journals from SJR to the journals in the
dataset</h1>
<p>df_works doesn’t work yet</p>
<div id="debugging" class="section level3" number="1.0.1">
<h3><span class="header-section-number">1.0.1</span> debugging</h3>
<pre class="r"><code>fcolnet_n &lt;- function(data = scholars, university = &quot;RU&quot;, discipline = &quot;sociology&quot;, waves = list(c(2015,
    2018), c(2019, 2023)), type = c(&quot;first&quot;)) {

    # step 1
    demographics &lt;- do.call(rbind.data.frame, data$demographics)
    demographics &lt;- demographics %&gt;%
        mutate(Universiteit1.22 = replace(Universiteit1.22, is.na(Universiteit1.22), &quot;&quot;), Universiteit2.22 = replace(Universiteit2.22,
            is.na(Universiteit2.22), &quot;&quot;), Universiteit1.24 = replace(Universiteit1.24, is.na(Universiteit1.24),
            &quot;&quot;), Universiteit2.24 = replace(Universiteit2.24, is.na(Universiteit2.24), &quot;&quot;), discipline.22 = replace(discipline.22,
            is.na(discipline.22), &quot;&quot;), discipline.24 = replace(discipline.24, is.na(discipline.24), &quot;&quot;))

    sample &lt;- which((demographics$Universiteit1.22 %in% university | demographics$Universiteit2.22 %in%
        university | demographics$Universiteit1.24 %in% university | demographics$Universiteit2.24 %in%
        university) &amp; (demographics$discipline.22 %in% discipline | demographics$discipline.24 %in% discipline))

    demographics_soc &lt;- demographics[sample, ]
    scholars_sel &lt;- lapply(scholars, &quot;[&quot;, sample)

    # step 2
    ids &lt;- demographics_soc$au_id
    nwaves &lt;- length(waves)
    nets &lt;- array(0, dim = c(nwaves, length(ids), length(ids)), dimnames = list(wave = 1:nwaves, ids,
        ids))
    dimnames(nets)

    # step 3
    df_works &lt;- tibble(works_id = unlist(lapply(scholars_sel$work, function(l) l$id)), works_author = unlist(lapply(scholars_sel$work,
        function(l) l$author), recursive = FALSE), works_year = unlist(lapply(scholars_sel$work, function(l) l$publication_year),
        recursive = FALSE))

    df_works &lt;- df_works[!duplicated(df_works), ]

    # step 4
    if (type == &quot;first&quot;) {
        for (j in 1:nwaves) {
            df_works_w &lt;- df_works[df_works$works_year &gt;= waves[[j]][1] &amp; df_works$works_year &lt;= waves[[j]][2],
                ]
            for (i in 1:nrow(df_works_w)) {
                ego &lt;- df_works_w$works_author[i][[1]]$au_id[1]
                alters &lt;- df_works_w$works_author[i][[1]]$au_id[-1]
                if (sum(ids %in% ego) &gt; 0 &amp; sum(ids %in% alters) &gt; 0) {
                  nets[j, which(ids %in% ego), which(ids %in% alters)] &lt;- 1
                }
            }
        }
    }

    if (type == &quot;last&quot;) {
        for (j in 1:nwaves) {
            df_works_w &lt;- df_works[df_works$works_year &gt;= waves[[j]][1] &amp; df_works$works_year &lt;= waves[[j]][2],
                ]
            for (i in 1:nrow(df_works_w)) {
                ego &lt;- rev(df_works_w$works_author[i][[1]]$au_id)[1]
                alters &lt;- rev(df_works_w$works_author[i][[1]]$au_id)[-1]
                if (sum(ids %in% ego) &gt; 0 &amp; sum(ids %in% alters) &gt; 0) {
                  nets[j, which(ids %in% ego), which(ids %in% alters)] &lt;- 1
                }
            }
        }
    }

    if (type == &quot;all&quot;) {
        for (j in 1:nwaves) {
            df_works_w &lt;- df_works[df_works$works_year &gt;= waves[[j]][1] &amp; df_works$works_year &lt;= waves[[j]][2],
                ]
            for (i in 1:nrow(df_works_w)) {
                egos &lt;- df_works_w$works_author[i][[1]]$au_id
                if (sum(ids %in% egos) &gt; 0) {
                  nets[j, which(ids %in% egos), which(ids %in% egos)] &lt;- 1
                }
            }
        }
    }
    output &lt;- list()
    output$data &lt;- scholars_sel
    output$nets &lt;- nets
    return(output)
}</code></pre>
<pre class="r"><code>scholars &lt;- fload(&quot;./data/processed/scholars_20240924.rda&quot;)</code></pre>
<pre class="r"><code>soc_data &lt;- fcolnet_n(data = scholars, university = c(&quot;RU&quot;, &quot;UU&quot;), discipline = c(&quot;sociology&quot;), waves = list(c(2015,
    2019), c(2020, 2024)), type = c(&quot;first&quot;))


df_ego &lt;- do.call(rbind.data.frame, soc_data$data$demographics)

df_works &lt;- do.call(rbind.data.frame, soc_data$data$works)  # put works in dataframe
# head(df_works)

test1 &lt;- df_works %&gt;% select(id, so, issn_l, author) # test the works

soc_data$nets[2,,] # How to call a specific network</code></pre>
<pre class="r"><code>df_works &lt;- tibble(works_id, works_author, works_year)</code></pre>
<pre class="r"><code>df_works_dataframe &lt;- as.data.frame(unique(sociologists$works))

sociologists2 &lt;- sociologists

require(reshape2)
install.packages(&quot;reshape2&quot;)</code></pre>
<pre class="r"><code>test1 &lt;- df_works %&gt;% select(id, so, issn_l, author) # test the works</code></pre>
<pre class="r"><code># Split the ISSN codes if 2 are available

sjr2022$Issn_1 &lt;- sapply(strsplit(sjr2022$Issn, &quot;, &quot;), `[`, 1)  # This code should work as a way to split the two issn codes
sjr2022$Issn_2 &lt;- sapply(strsplit(sjr2022$Issn, &quot;, &quot;), `[`, 2)

sjr2024$Issn_1 &lt;- sapply(strsplit(sjr2024$Issn, &quot;, &quot;), `[`, 1)  # This code should work as a way to split the two issn codes
sjr2024$Issn_2 &lt;- sapply(strsplit(sjr2024$Issn, &quot;, &quot;), `[`, 2)

# dat$Issn_1[1] str_length(dat$Issn_1[1])

sjr2022$Issn_1 &lt;- paste0(substr(sjr2022$Issn_1, 1, 4), &quot;-&quot;, substr(sjr2022$Issn_1, 5, 8))  # Hyphenate the codes to match the target df 
sjr2022$Issn_2 &lt;- ifelse(is.na(sjr2022$Issn_2) == TRUE, NA, paste0(substr(sjr2022$Issn_2, 1, 4), &quot;-&quot;, substr(sjr2022$Issn_2,
    5, 8)))  # Hyphenate the codes, but make non-existing second codes NA

sjr2024$Issn_1 &lt;- paste0(substr(sjr2024$Issn_1, 1, 4), &quot;-&quot;, substr(sjr2024$Issn_1, 5, 8))  # Hyphenate the codes to match the target df 
sjr2024$Issn_2 &lt;- ifelse(is.na(sjr2024$Issn_2) == TRUE, NA, paste0(substr(sjr2024$Issn_2, 1, 4), &quot;-&quot;, substr(sjr2024$Issn_2,
    5, 8)))  # Hyphenate the codes, but make non-existing second codes NA


df_pres_22 &lt;- sjr2022 %&gt;%
    select(Rank, Title, Issn_1, Issn_2, SJR, `SJR Quartile`, `H index`, `%Female`)  # Make a set that will be joined with df_works

df_pres_24 &lt;- sjr2024 %&gt;%
    select(Rank, Title, Issn_1, Issn_2, SJR, `SJR Quartile`, `H index`, `%Female`)  # Make a set that will be joined with df_works

df_pres_22

# df_works %&gt;% select(issn_l) df_pres %&gt;% select(Issn_1, Issn_2)
df_works$check &lt;- ifelse(df_works$issn_l %in% df_pres_22$Issn_1 | df_works$issn_l %in% df_pres_22$Issn_2, 1,
    0)

mis_journal &lt;- df_works %&gt;%
    filter(check == 0)

as.data.frame(unique(mis_journal$so))</code></pre>
</div>
<div id="create-id-variable" class="section level3" number="1.0.2">
<h3><span class="header-section-number">1.0.2</span> Create ID
variable</h3>
<pre class="r"><code>df_pres_22 &lt;- df_pres_22 %&gt;%
    mutate(issn_l = case_when(Issn_1 %in% df_works$issn_l == TRUE ~ Issn_1, Issn_2 %in% df_works$issn_l ==
        TRUE ~ Issn_2, .default = NA)) %&gt;%
    filter(!is.na(issn_l))

df_pres_24 &lt;- df_pres_24 %&gt;%
    mutate(issn_l = case_when(Issn_1 %in% df_works$issn_l == TRUE ~ Issn_1, Issn_2 %in% df_works$issn_l ==
        TRUE ~ Issn_2, .default = NA)) %&gt;%
    filter(!is.na(issn_l))</code></pre>
<pre class="r"><code>#---- String Stripper ----
str_strip &lt;- function(input = &quot;THIs StrïnG is ÑorMälìZed&quot;) {

    string &lt;- tolower(input)
    string &lt;- iconv(string, from = &quot;UTF-8&quot;, to = &quot;ASCII//TRANSLIT&quot;)
    string &lt;- sub(&quot;.* &quot;, &quot;&quot;, string)

    # string &lt;- gsub(&#39;[[:punct:]]&#39;, &#39; &#39;, string)

    return(string)
}</code></pre>
</div>
<div id="looping-algorithm-logic" class="section level3" number="1.0.3">
<h3><span class="header-section-number">1.0.3</span> Looping algorithm
logic</h3>
<pre class="r"><code>list_works &lt;- soc_data$data$works

df_ego$Q1.W1 &lt;- 0
df_ego$Q1.W2 &lt;- 0

for (i in 1:length(list_works)) {

    wave1s &lt;- 2015
    wave1e &lt;- 2019
    wave2s &lt;- 2020
    wave2e &lt;- 2024

    works &lt;- list_works[[i]]

    works &lt;- works %&gt;%
        left_join(df_pres_24, by = &quot;issn_l&quot;, multiple = &quot;all&quot;)
    works$`SJR Quartile` &lt;- ifelse(is.na(works$`SJR Quartile`), &quot;No Rank&quot;, works$`SJR Quartile`)

    au &lt;- works %&gt;%
        unnest(author) %&gt;%
        mutate(check_id = au_id %in% df_ego$au_id) %&gt;%
        mutate(check_nam = str_strip(au_display_name) %in% str_strip(df_ego$Naam)) %&gt;%
        filter(check_id == TRUE &amp; check_nam == TRUE)

    works &lt;- works %&gt;%
        mutate(waves = case_when(publication_year &gt;= wave1s &amp; publication_year &lt;= wave1e ~ &quot;Wave 1&quot;,
            publication_year &gt;= wave2s &amp; publication_year &lt;= wave2e ~ &quot;Wave 2&quot;, .default = &quot;NA&quot;)) %&gt;%
        filter(waves != &quot;NA&quot;)
    if (nrow(works) == 0) {

        next

    } else {

        for (x in 1:nrow(works)) {

            if (works$waves[x] == &quot;Wave 1&quot;) {

                if (works$`SJR Quartile`[x] == &quot;Q1&quot;) {

                  naam &lt;- works$author[[x]]$au_display_name
                  df_ego[str_strip(df_ego$Naam) %in% str_strip(naam), ]$Q1.W1 &lt;- df_ego[str_strip(df_ego$Naam) %in%
                    str_strip(naam), ]$Q1.W1 + 1

                }
            } else {

                if (works$`SJR Quartile`[x] == &quot;Q1&quot;) {

                  naam &lt;- works$author[[x]]$au_display_name
                  df_ego[str_strip(df_ego$Naam) %in% str_strip(naam), ]$Q1.W2 &lt;- df_ego[str_strip(df_ego$Naam) %in%
                    str_strip(naam), ]$Q1.W2 + 1

                }
            }

        }

    }

}</code></pre>
</div>
<div id="career-age" class="section level3" number="1.0.4">
<h3><span class="header-section-number">1.0.4</span> Career age</h3>
<pre class="r"><code>df_career_age &lt;- df_works %&gt;%
  unnest(author) %&gt;% # unnesting the tibble from the tibble
  filter(au_id %in% df_ego$au_id == TRUE) %&gt;% # authors in df_works should match authors in df_ego
  group_by(au_id) %&gt;%
  mutate(min_year_pub = min(publication_year, na.rm = TRUE), # initial calculation of minimum year
         count_pub = n()) %&gt;%  # count number of publications
  mutate(first_year_pub = ifelse(count_pub == 1, min_year_pub, # if number of publications is 1, score is min_year_pub
                                 {
                                   filter_year = publication_year[publication_year != min_year_pub] # filter minimum year
                                   mean_pubyear = mean(filter_year, na.rm = TRUE) # calculate mean without min score
                                   valid_year = min(filter_year[filter_year &gt;= (mean_pubyear - 25)], na.rm = TRUE) # minimum year -&gt; range mean-25
                                   valid_year # if number of publications is not 1, than score minimum year with first year removed within range mean-25
                                 })) %&gt;% 
  
  # this line corrects for the warning of returning infinites that for some reason were not filtered through the first ifelse command
  mutate(first_year_pub = ifelse(is.infinite(first_year_pub), min_year_pub, first_year_pub)) %&gt;% #adjusting infinite scores to minimum year
  
  select(au_id, first_year_pub) %&gt;% # selecting variables
  distinct(au_id, first_year_pub, .keep_all = TRUE) # making sure only distinct authors are in data frame  
  

df_ego &lt;- df_ego %&gt;% left_join(df_career_age, by = &quot;au_id&quot;)</code></pre>
</div>
<div id="practicing-with-rsiena-without-prestige" class="section level2"
number="1.1">
<h2><span class="header-section-number">1.1</span> Practicing with
RSiena without prestige</h2>
<div id="own-fcolnet-different-from-niels" class="section level3"
number="1.1.1">
<h3><span class="header-section-number">1.1.1</span> own fcolnet,
different from niels</h3>
<pre class="r"><code>fcolnet_25 &lt;- function(data = scholars, university = &quot;RU&quot;, discipline = &quot;sociology&quot;, waves = list(c(2015,
    2018), c(2019, 2023)), type = c(&quot;first&quot;)) {

    # step 1
    demographics &lt;- do.call(rbind.data.frame, data$demographics)
    demographics &lt;- demographics %&gt;%
        mutate(Universiteit1.22 = replace(Universiteit1.22, is.na(Universiteit1.22), &quot;&quot;), Universiteit2.22 = replace(Universiteit2.22,
            is.na(Universiteit2.22), &quot;&quot;), Universiteit1.24 = replace(Universiteit1.24, is.na(Universiteit1.24),
            &quot;&quot;), Universiteit2.24 = replace(Universiteit2.24, is.na(Universiteit2.24), &quot;&quot;), discipline.22 = replace(discipline.22,
            is.na(discipline.22), &quot;&quot;), discipline.24 = replace(discipline.24, is.na(discipline.24), &quot;&quot;))

    sample &lt;- which((demographics$Universiteit1.22 %in% university | demographics$Universiteit2.22 %in%
        university | demographics$Universiteit1.24 %in% university | demographics$Universiteit2.24 %in%
        university) &amp; (demographics$discipline.22 %in% discipline | demographics$discipline.24 %in% discipline))

    demographics_soc &lt;- demographics[sample, ]
    scholars_sel &lt;- lapply(scholars, &quot;[&quot;, sample)

    # step 2
    ids &lt;- demographics_soc$au_id
    nwaves &lt;- length(waves)
    nets &lt;- array(0, dim = c(nwaves, length(ids), length(ids)), dimnames = list(wave = 1:nwaves, ids,
        ids))
    dimnames(nets)

    # step 3
    df_works &lt;- tibble(works_id = unlist(lapply(scholars_sel$work, function(l) l$id)), works_author = unlist(lapply(scholars_sel$work,
        function(l) l$author), recursive = FALSE), works_year = unlist(lapply(scholars_sel$work, function(l) l$publication_year),
        recursive = FALSE))

    df_works &lt;- df_works[!duplicated(df_works), ]

    # step 4
    if (type == &quot;first&quot;) {
        for (j in 1:nwaves) {
            df_works_w &lt;- df_works[df_works$works_year &gt;= waves[[j]][1] &amp; df_works$works_year &lt;= waves[[j]][2],
                ]
            for (i in 1:nrow(df_works_w)) {
                ego &lt;- df_works_w$works_author[i][[1]]$au_id[1]
                alters &lt;- df_works_w$works_author[i][[1]]$au_id[-1]
                if (sum(ids %in% ego) &gt; 0 &amp; sum(ids %in% alters) &gt; 0) {
                  nets[j, which(ids %in% ego), which(ids %in% alters)] &lt;- 1
                }
            }
        }
    }

    if (type == &quot;last&quot;) {
        for (j in 1:nwaves) {
            df_works_w &lt;- df_works[df_works$works_year &gt;= waves[[j]][1] &amp; df_works$works_year &lt;= waves[[j]][2],
                ]
            for (i in 1:nrow(df_works_w)) {
                ego &lt;- rev(df_works_w$works_author[i][[1]]$au_id)[1]
                alters &lt;- rev(df_works_w$works_author[i][[1]]$au_id)[-1]
                if (sum(ids %in% ego) &gt; 0 &amp; sum(ids %in% alters) &gt; 0) {
                  nets[j, which(ids %in% ego), which(ids %in% alters)] &lt;- 1
                }
            }
        }
    }

    if (type == &quot;all&quot;) {
        for (j in 1:nwaves) {
            df_works_w &lt;- df_works[df_works$works_year &gt;= waves[[j]][1] &amp; df_works$works_year &lt;= waves[[j]][2],
                ]
            for (i in 1:nrow(df_works_w)) {
                egos &lt;- df_works_w$works_author[i][[1]]$au_id
                if (sum(ids %in% egos) &gt; 0) {
                  nets[j, which(ids %in% egos), which(ids %in% egos)] &lt;- 1
                }
            }
        }
    }
    output &lt;- list()
    output$data &lt;- scholars_sel
    output$nets &lt;- nets
    return(output)
}</code></pre>
<pre class="r"><code># soc_test_data &lt;- sienaDataCreate(wave1, wave2)

soc_test_data &lt;- sienaDependent(array(c(wave1, wave2), dim = c(386, 386)))</code></pre>
<p>Trying to get a network for RSiena</p>
<pre class="r"><code>test_RU &lt;- fcolnet_25(data = scholars, 
                    university = &quot;RU&quot;,
                    discipline = &quot;sociology&quot;, 
                    waves = list(c(2015, 2018), c(2019, 2023)), 
                    type = c(&quot;first&quot;))

test_UvT &lt;- fcolnet_25(data = scholars, 
                    university = &quot;UvT&quot;,
                    discipline = &quot;sociology&quot;, 
                    waves = list(c(2015, 2018), c(2019, 2023)), 
                    type = c(&quot;first&quot;))

soc_test_data &lt;- sienaDataCreate(test_RU, test_UvT)

soc_test_data &lt;- sienaDependent(array(c(test_RU, test_UvT, dim = c(386, 386)))</code></pre>
<table style="width:7%;">
<colgroup>
<col width="6%" />
</colgroup>
<tbody>
<tr class="odd">
<td># Two articles</td>
</tr>
<tr class="even">
<td>We had to send in two articles before class.</td>
</tr>
<tr class="odd">
<td>Hancean et al. (2014) is about collaboration networks across the 17
Romanian sociology departments. I found the theoretical section useful,
as it listed previous empirical findings of collaboration network
structures, I believe specifically in sociology. The first one,
small-world networks were more often found in cross-disciplinary
collaborations. “Collaboration networks that fit small-world models are
expected to have many distinct clusters of researchers investigating
specific subjects or implementing particular research projects, while
the geodesics among these clusters are small (low number of links or
degree of separation)” (Hancean et al., 2014, 2). The second one seems
the most relevant to me, the <strong>principle of preferential
attachment</strong>. “New links and nodes are not randomly connected to
large networks, but based on observed power-law distributions”,
Matthew-effect: scientific fields grow and develop around highly
prestigious scientific scholars. Thirdly, networks defined by structural
cohesion, which are densely connected, with no vulnerabilities for
fragmentation. Finally, the core-periphery model is defined as “networks
consisting of one group (the core) to which all actors belong to a
greater or lesser extent”.</td>
</tr>
<tr class="even">
<td>Knoke and Yang (2011) explained how prestige works in social
networks, that an ego receives much less ties that they receive.</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="rmd-source-code">LS0tCnRpdGxlOiAibGFiNiIKYXV0aG9yOiAiR2hpc2xhaW5lIGRlIEdyb290IgpkYXRlOiAiMjAyNS0xMC0xMCIKb3V0cHV0OiBodG1sX2RvY3VtZW50Ci0tLQpgYGB7ciBzZXR1cCwgaW5jbHVkZT1GQUxTRX0Ka25pdHI6Om9wdHNfY2h1bmskc2V0KGVjaG8gPSBUUlVFKQpgYGAKCiMjIyBQYWNrYWdlcwoKYGBge3IsIGV2YWw9RkFMU0V9CmxpYnJhcnkoZm9yZWlnbikKbGlicmFyeSh0aWR5dmVyc2UpCmxpYnJhcnkoc2Nob2xhcikgCmxpYnJhcnkob3BlbmFsZXhSKQpsaWJyYXJ5KHJ2ZXN0KSAKbGlicmFyeShqc29ubGl0ZSkKbGlicmFyeShSU2llbmEpCgpgYGAKCgojIyMgTG9hZGluZyB0aGUgam91cm5hbCBkYXRhc2V0CgpgYGB7ciwgZXZhbD1GQUxTRX0KCnNqcjIwMjIgPC0gcmVhZF9jc3YyKCcvVXNlcnMvZ2hpc2xhaW5lL0Rvd25sb2Fkcy9HaXRodWIvU29jaWFsIE5ldHdvcmtzL3NjaW1hZ29qciAyMDIyIFN1YmplY3QgQ2F0ZWdvcnkgLSBTb2Npb2xvZ3kgYW5kIFBvbGl0aWNhbCBTY2llbmNlLmNzdicpCgpzanIyMDI0IDwtIHJlYWRfY3N2MignL1VzZXJzL2doaXNsYWluZS9Eb3dubG9hZHMvR2l0aHViL1NvY2lhbCBOZXR3b3Jrcy9zY2ltYWdvanIgMjAyNCBTdWJqZWN0IENhdGVnb3J5IC0gU29jaW9sb2d5IGFuZCBQb2xpdGljYWwgU2NpZW5jZS5jc3YnKQoKYGBgCgojIFN0ZWFsaW5nIE5pZWxzIFZ1bGxpbmdzJyBjb2RlIGFuZCBsaW5raW5nIHRoZSBqb3VybmFscyBmcm9tIFNKUiB0byB0aGUgam91cm5hbHMgaW4gdGhlIGRhdGFzZXQKCgpkZl93b3JrcyBkb2Vzbid0IHdvcmsgeWV0CgpgYGB7ciwgZWNobz1GQUxTRSwgZXZhbD1GQUxTRX0KCmRmX3dvcmtzX2RhdGFmcmFtZSA8LSBkby5jYWxsKHJiaW5kLmRhdGEuZnJhbWUsIHNvY2lvbG9naXN0cyR3b3JrcykgICMgcHV0IHdvcmtzIGluIGRhdGFmcmFtZQojIGhlYWQoZGZfd29ya3MpCgpkZl93b3Jrc19kYXRhZnJhbWUgPC0gZG8uY2FsbChyYmluZC5kYXRhLmZyYW1lLCBzb2Npb2xvZ2lzdHMkd29ya3MpCgpgYGAKCiMjIyBkZWJ1Z2dpbmcKCmBgYHtyLCBldmFsPUZBTFNFfQpmY29sbmV0X24gPC0gZnVuY3Rpb24oZGF0YSA9IHNjaG9sYXJzLCB1bml2ZXJzaXR5ID0gIlJVIiwgZGlzY2lwbGluZSA9ICJzb2Npb2xvZ3kiLCB3YXZlcyA9IGxpc3QoYygyMDE1LAogICAgMjAxOCksIGMoMjAxOSwgMjAyMykpLCB0eXBlID0gYygiZmlyc3QiKSkgewoKICAgICMgc3RlcCAxCiAgICBkZW1vZ3JhcGhpY3MgPC0gZG8uY2FsbChyYmluZC5kYXRhLmZyYW1lLCBkYXRhJGRlbW9ncmFwaGljcykKICAgIGRlbW9ncmFwaGljcyA8LSBkZW1vZ3JhcGhpY3MgJT4lCiAgICAgICAgbXV0YXRlKFVuaXZlcnNpdGVpdDEuMjIgPSByZXBsYWNlKFVuaXZlcnNpdGVpdDEuMjIsIGlzLm5hKFVuaXZlcnNpdGVpdDEuMjIpLCAiIiksIFVuaXZlcnNpdGVpdDIuMjIgPSByZXBsYWNlKFVuaXZlcnNpdGVpdDIuMjIsCiAgICAgICAgICAgIGlzLm5hKFVuaXZlcnNpdGVpdDIuMjIpLCAiIiksIFVuaXZlcnNpdGVpdDEuMjQgPSByZXBsYWNlKFVuaXZlcnNpdGVpdDEuMjQsIGlzLm5hKFVuaXZlcnNpdGVpdDEuMjQpLAogICAgICAgICAgICAiIiksIFVuaXZlcnNpdGVpdDIuMjQgPSByZXBsYWNlKFVuaXZlcnNpdGVpdDIuMjQsIGlzLm5hKFVuaXZlcnNpdGVpdDIuMjQpLCAiIiksIGRpc2NpcGxpbmUuMjIgPSByZXBsYWNlKGRpc2NpcGxpbmUuMjIsCiAgICAgICAgICAgIGlzLm5hKGRpc2NpcGxpbmUuMjIpLCAiIiksIGRpc2NpcGxpbmUuMjQgPSByZXBsYWNlKGRpc2NpcGxpbmUuMjQsIGlzLm5hKGRpc2NpcGxpbmUuMjQpLCAiIikpCgogICAgc2FtcGxlIDwtIHdoaWNoKChkZW1vZ3JhcGhpY3MkVW5pdmVyc2l0ZWl0MS4yMiAlaW4lIHVuaXZlcnNpdHkgfCBkZW1vZ3JhcGhpY3MkVW5pdmVyc2l0ZWl0Mi4yMiAlaW4lCiAgICAgICAgdW5pdmVyc2l0eSB8IGRlbW9ncmFwaGljcyRVbml2ZXJzaXRlaXQxLjI0ICVpbiUgdW5pdmVyc2l0eSB8IGRlbW9ncmFwaGljcyRVbml2ZXJzaXRlaXQyLjI0ICVpbiUKICAgICAgICB1bml2ZXJzaXR5KSAmIChkZW1vZ3JhcGhpY3MkZGlzY2lwbGluZS4yMiAlaW4lIGRpc2NpcGxpbmUgfCBkZW1vZ3JhcGhpY3MkZGlzY2lwbGluZS4yNCAlaW4lIGRpc2NpcGxpbmUpKQoKICAgIGRlbW9ncmFwaGljc19zb2MgPC0gZGVtb2dyYXBoaWNzW3NhbXBsZSwgXQogICAgc2Nob2xhcnNfc2VsIDwtIGxhcHBseShzY2hvbGFycywgIlsiLCBzYW1wbGUpCgogICAgIyBzdGVwIDIKICAgIGlkcyA8LSBkZW1vZ3JhcGhpY3Nfc29jJGF1X2lkCiAgICBud2F2ZXMgPC0gbGVuZ3RoKHdhdmVzKQogICAgbmV0cyA8LSBhcnJheSgwLCBkaW0gPSBjKG53YXZlcywgbGVuZ3RoKGlkcyksIGxlbmd0aChpZHMpKSwgZGltbmFtZXMgPSBsaXN0KHdhdmUgPSAxOm53YXZlcywgaWRzLAogICAgICAgIGlkcykpCiAgICBkaW1uYW1lcyhuZXRzKQoKICAgICMgc3RlcCAzCiAgICBkZl93b3JrcyA8LSB0aWJibGUod29ya3NfaWQgPSB1bmxpc3QobGFwcGx5KHNjaG9sYXJzX3NlbCR3b3JrLCBmdW5jdGlvbihsKSBsJGlkKSksIHdvcmtzX2F1dGhvciA9IHVubGlzdChsYXBwbHkoc2Nob2xhcnNfc2VsJHdvcmssCiAgICAgICAgZnVuY3Rpb24obCkgbCRhdXRob3IpLCByZWN1cnNpdmUgPSBGQUxTRSksIHdvcmtzX3llYXIgPSB1bmxpc3QobGFwcGx5KHNjaG9sYXJzX3NlbCR3b3JrLCBmdW5jdGlvbihsKSBsJHB1YmxpY2F0aW9uX3llYXIpLAogICAgICAgIHJlY3Vyc2l2ZSA9IEZBTFNFKSkKCiAgICBkZl93b3JrcyA8LSBkZl93b3Jrc1shZHVwbGljYXRlZChkZl93b3JrcyksIF0KCiAgICAjIHN0ZXAgNAogICAgaWYgKHR5cGUgPT0gImZpcnN0IikgewogICAgICAgIGZvciAoaiBpbiAxOm53YXZlcykgewogICAgICAgICAgICBkZl93b3Jrc193IDwtIGRmX3dvcmtzW2RmX3dvcmtzJHdvcmtzX3llYXIgPj0gd2F2ZXNbW2pdXVsxXSAmIGRmX3dvcmtzJHdvcmtzX3llYXIgPD0gd2F2ZXNbW2pdXVsyXSwKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgZm9yIChpIGluIDE6bnJvdyhkZl93b3Jrc193KSkgewogICAgICAgICAgICAgICAgZWdvIDwtIGRmX3dvcmtzX3ckd29ya3NfYXV0aG9yW2ldW1sxXV0kYXVfaWRbMV0KICAgICAgICAgICAgICAgIGFsdGVycyA8LSBkZl93b3Jrc193JHdvcmtzX2F1dGhvcltpXVtbMV1dJGF1X2lkWy0xXQogICAgICAgICAgICAgICAgaWYgKHN1bShpZHMgJWluJSBlZ28pID4gMCAmIHN1bShpZHMgJWluJSBhbHRlcnMpID4gMCkgewogICAgICAgICAgICAgICAgICBuZXRzW2osIHdoaWNoKGlkcyAlaW4lIGVnbyksIHdoaWNoKGlkcyAlaW4lIGFsdGVycyldIDwtIDEKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBpZiAodHlwZSA9PSAibGFzdCIpIHsKICAgICAgICBmb3IgKGogaW4gMTpud2F2ZXMpIHsKICAgICAgICAgICAgZGZfd29ya3NfdyA8LSBkZl93b3Jrc1tkZl93b3JrcyR3b3Jrc195ZWFyID49IHdhdmVzW1tqXV1bMV0gJiBkZl93b3JrcyR3b3Jrc195ZWFyIDw9IHdhdmVzW1tqXV1bMl0sCiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgIGZvciAoaSBpbiAxOm5yb3coZGZfd29ya3NfdykpIHsKICAgICAgICAgICAgICAgIGVnbyA8LSByZXYoZGZfd29ya3NfdyR3b3Jrc19hdXRob3JbaV1bWzFdXSRhdV9pZClbMV0KICAgICAgICAgICAgICAgIGFsdGVycyA8LSByZXYoZGZfd29ya3NfdyR3b3Jrc19hdXRob3JbaV1bWzFdXSRhdV9pZClbLTFdCiAgICAgICAgICAgICAgICBpZiAoc3VtKGlkcyAlaW4lIGVnbykgPiAwICYgc3VtKGlkcyAlaW4lIGFsdGVycykgPiAwKSB7CiAgICAgICAgICAgICAgICAgIG5ldHNbaiwgd2hpY2goaWRzICVpbiUgZWdvKSwgd2hpY2goaWRzICVpbiUgYWx0ZXJzKV0gPC0gMQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGlmICh0eXBlID09ICJhbGwiKSB7CiAgICAgICAgZm9yIChqIGluIDE6bndhdmVzKSB7CiAgICAgICAgICAgIGRmX3dvcmtzX3cgPC0gZGZfd29ya3NbZGZfd29ya3Mkd29ya3NfeWVhciA+PSB3YXZlc1tbal1dWzFdICYgZGZfd29ya3Mkd29ya3NfeWVhciA8PSB3YXZlc1tbal1dWzJdLAogICAgICAgICAgICAgICAgXQogICAgICAgICAgICBmb3IgKGkgaW4gMTpucm93KGRmX3dvcmtzX3cpKSB7CiAgICAgICAgICAgICAgICBlZ29zIDwtIGRmX3dvcmtzX3ckd29ya3NfYXV0aG9yW2ldW1sxXV0kYXVfaWQKICAgICAgICAgICAgICAgIGlmIChzdW0oaWRzICVpbiUgZWdvcykgPiAwKSB7CiAgICAgICAgICAgICAgICAgIG5ldHNbaiwgd2hpY2goaWRzICVpbiUgZWdvcyksIHdoaWNoKGlkcyAlaW4lIGVnb3MpXSA8LSAxCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICBvdXRwdXQgPC0gbGlzdCgpCiAgICBvdXRwdXQkZGF0YSA8LSBzY2hvbGFyc19zZWwKICAgIG91dHB1dCRuZXRzIDwtIG5ldHMKICAgIHJldHVybihvdXRwdXQpCn0KYGBgCgoKCgpgYGB7ciwgZXZhbD1GQUxTRX0Kc2Nob2xhcnMgPC0gZmxvYWQoIi4vZGF0YS9wcm9jZXNzZWQvc2Nob2xhcnNfMjAyNDA5MjQucmRhIikKYGBgCgoKYGBge3IsIGV2YWw9RkFMU0V9CnNvY19kYXRhIDwtIGZjb2xuZXRfbihkYXRhID0gc2Nob2xhcnMsIHVuaXZlcnNpdHkgPSBjKCJSVSIsICJVVSIpLCBkaXNjaXBsaW5lID0gYygic29jaW9sb2d5IiksIHdhdmVzID0gbGlzdChjKDIwMTUsCiAgICAyMDE5KSwgYygyMDIwLCAyMDI0KSksIHR5cGUgPSBjKCJmaXJzdCIpKQoKCmRmX2VnbyA8LSBkby5jYWxsKHJiaW5kLmRhdGEuZnJhbWUsIHNvY19kYXRhJGRhdGEkZGVtb2dyYXBoaWNzKQoKZGZfd29ya3MgPC0gZG8uY2FsbChyYmluZC5kYXRhLmZyYW1lLCBzb2NfZGF0YSRkYXRhJHdvcmtzKSAgIyBwdXQgd29ya3MgaW4gZGF0YWZyYW1lCiMgaGVhZChkZl93b3JrcykKCnRlc3QxIDwtIGRmX3dvcmtzICU+JSBzZWxlY3QoaWQsIHNvLCBpc3NuX2wsIGF1dGhvcikgIyB0ZXN0IHRoZSB3b3JrcwoKc29jX2RhdGEkbmV0c1syLCxdICMgSG93IHRvIGNhbGwgYSBzcGVjaWZpYyBuZXR3b3JrCgpgYGAKCmBgYHtyLCBldmFsPUZBTFNFfQpkZl93b3JrcyA8LSB0aWJibGUod29ya3NfaWQsIHdvcmtzX2F1dGhvciwgd29ya3NfeWVhcikKYGBgCgoKYGBge3IsIGV2YWw9RkFMU0V9CmRmX3dvcmtzX2RhdGFmcmFtZSA8LSBhcy5kYXRhLmZyYW1lKHVuaXF1ZShzb2Npb2xvZ2lzdHMkd29ya3MpKQoKc29jaW9sb2dpc3RzMiA8LSBzb2Npb2xvZ2lzdHMKCnJlcXVpcmUocmVzaGFwZTIpCmluc3RhbGwucGFja2FnZXMoInJlc2hhcGUyIikKCgpgYGAKCgpgYGB7ciwgZXZhbD1GQUxTRX0KdGVzdDEgPC0gZGZfd29ya3MgJT4lIHNlbGVjdChpZCwgc28sIGlzc25fbCwgYXV0aG9yKSAjIHRlc3QgdGhlIHdvcmtzCmBgYAoKYGBge3IsIGV2YWw9RkFMU0V9CiMgU3BsaXQgdGhlIElTU04gY29kZXMgaWYgMiBhcmUgYXZhaWxhYmxlCgpzanIyMDIyJElzc25fMSA8LSBzYXBwbHkoc3Ryc3BsaXQoc2pyMjAyMiRJc3NuLCAiLCAiKSwgYFtgLCAxKSAgIyBUaGlzIGNvZGUgc2hvdWxkIHdvcmsgYXMgYSB3YXkgdG8gc3BsaXQgdGhlIHR3byBpc3NuIGNvZGVzCnNqcjIwMjIkSXNzbl8yIDwtIHNhcHBseShzdHJzcGxpdChzanIyMDIyJElzc24sICIsICIpLCBgW2AsIDIpCgpzanIyMDI0JElzc25fMSA8LSBzYXBwbHkoc3Ryc3BsaXQoc2pyMjAyNCRJc3NuLCAiLCAiKSwgYFtgLCAxKSAgIyBUaGlzIGNvZGUgc2hvdWxkIHdvcmsgYXMgYSB3YXkgdG8gc3BsaXQgdGhlIHR3byBpc3NuIGNvZGVzCnNqcjIwMjQkSXNzbl8yIDwtIHNhcHBseShzdHJzcGxpdChzanIyMDI0JElzc24sICIsICIpLCBgW2AsIDIpCgojIGRhdCRJc3NuXzFbMV0gc3RyX2xlbmd0aChkYXQkSXNzbl8xWzFdKQoKc2pyMjAyMiRJc3NuXzEgPC0gcGFzdGUwKHN1YnN0cihzanIyMDIyJElzc25fMSwgMSwgNCksICItIiwgc3Vic3RyKHNqcjIwMjIkSXNzbl8xLCA1LCA4KSkgICMgSHlwaGVuYXRlIHRoZSBjb2RlcyB0byBtYXRjaCB0aGUgdGFyZ2V0IGRmIApzanIyMDIyJElzc25fMiA8LSBpZmVsc2UoaXMubmEoc2pyMjAyMiRJc3NuXzIpID09IFRSVUUsIE5BLCBwYXN0ZTAoc3Vic3RyKHNqcjIwMjIkSXNzbl8yLCAxLCA0KSwgIi0iLCBzdWJzdHIoc2pyMjAyMiRJc3NuXzIsCiAgICA1LCA4KSkpICAjIEh5cGhlbmF0ZSB0aGUgY29kZXMsIGJ1dCBtYWtlIG5vbi1leGlzdGluZyBzZWNvbmQgY29kZXMgTkEKCnNqcjIwMjQkSXNzbl8xIDwtIHBhc3RlMChzdWJzdHIoc2pyMjAyNCRJc3NuXzEsIDEsIDQpLCAiLSIsIHN1YnN0cihzanIyMDI0JElzc25fMSwgNSwgOCkpICAjIEh5cGhlbmF0ZSB0aGUgY29kZXMgdG8gbWF0Y2ggdGhlIHRhcmdldCBkZiAKc2pyMjAyNCRJc3NuXzIgPC0gaWZlbHNlKGlzLm5hKHNqcjIwMjQkSXNzbl8yKSA9PSBUUlVFLCBOQSwgcGFzdGUwKHN1YnN0cihzanIyMDI0JElzc25fMiwgMSwgNCksICItIiwgc3Vic3RyKHNqcjIwMjQkSXNzbl8yLAogICAgNSwgOCkpKSAgIyBIeXBoZW5hdGUgdGhlIGNvZGVzLCBidXQgbWFrZSBub24tZXhpc3Rpbmcgc2Vjb25kIGNvZGVzIE5BCgoKZGZfcHJlc18yMiA8LSBzanIyMDIyICU+JQogICAgc2VsZWN0KFJhbmssIFRpdGxlLCBJc3NuXzEsIElzc25fMiwgU0pSLCBgU0pSIFF1YXJ0aWxlYCwgYEggaW5kZXhgLCBgJUZlbWFsZWApICAjIE1ha2UgYSBzZXQgdGhhdCB3aWxsIGJlIGpvaW5lZCB3aXRoIGRmX3dvcmtzCgpkZl9wcmVzXzI0IDwtIHNqcjIwMjQgJT4lCiAgICBzZWxlY3QoUmFuaywgVGl0bGUsIElzc25fMSwgSXNzbl8yLCBTSlIsIGBTSlIgUXVhcnRpbGVgLCBgSCBpbmRleGAsIGAlRmVtYWxlYCkgICMgTWFrZSBhIHNldCB0aGF0IHdpbGwgYmUgam9pbmVkIHdpdGggZGZfd29ya3MKCmRmX3ByZXNfMjIKCiMgZGZfd29ya3MgJT4lIHNlbGVjdChpc3NuX2wpIGRmX3ByZXMgJT4lIHNlbGVjdChJc3NuXzEsIElzc25fMikKZGZfd29ya3MkY2hlY2sgPC0gaWZlbHNlKGRmX3dvcmtzJGlzc25fbCAlaW4lIGRmX3ByZXNfMjIkSXNzbl8xIHwgZGZfd29ya3MkaXNzbl9sICVpbiUgZGZfcHJlc18yMiRJc3NuXzIsIDEsCiAgICAwKQoKbWlzX2pvdXJuYWwgPC0gZGZfd29ya3MgJT4lCiAgICBmaWx0ZXIoY2hlY2sgPT0gMCkKCmFzLmRhdGEuZnJhbWUodW5pcXVlKG1pc19qb3VybmFsJHNvKSkKCmBgYAoKIyMjIENyZWF0ZSBJRCB2YXJpYWJsZQoKYGBge3IsIGV2YWw9RkFMU0V9CgpkZl9wcmVzXzIyIDwtIGRmX3ByZXNfMjIgJT4lCiAgICBtdXRhdGUoaXNzbl9sID0gY2FzZV93aGVuKElzc25fMSAlaW4lIGRmX3dvcmtzJGlzc25fbCA9PSBUUlVFIH4gSXNzbl8xLCBJc3NuXzIgJWluJSBkZl93b3JrcyRpc3NuX2wgPT0KICAgICAgICBUUlVFIH4gSXNzbl8yLCAuZGVmYXVsdCA9IE5BKSkgJT4lCiAgICBmaWx0ZXIoIWlzLm5hKGlzc25fbCkpCgpkZl9wcmVzXzI0IDwtIGRmX3ByZXNfMjQgJT4lCiAgICBtdXRhdGUoaXNzbl9sID0gY2FzZV93aGVuKElzc25fMSAlaW4lIGRmX3dvcmtzJGlzc25fbCA9PSBUUlVFIH4gSXNzbl8xLCBJc3NuXzIgJWluJSBkZl93b3JrcyRpc3NuX2wgPT0KICAgICAgICBUUlVFIH4gSXNzbl8yLCAuZGVmYXVsdCA9IE5BKSkgJT4lCiAgICBmaWx0ZXIoIWlzLm5hKGlzc25fbCkpCgpgYGAKCmBgYHtyLCBldmFsPUZBTFNFfQojLS0tLSBTdHJpbmcgU3RyaXBwZXIgLS0tLQpzdHJfc3RyaXAgPC0gZnVuY3Rpb24oaW5wdXQgPSAiVEhJcyBTdHLDr25HIGlzIMORb3JNw6Rsw6xaZWQiKSB7CgogICAgc3RyaW5nIDwtIHRvbG93ZXIoaW5wdXQpCiAgICBzdHJpbmcgPC0gaWNvbnYoc3RyaW5nLCBmcm9tID0gIlVURi04IiwgdG8gPSAiQVNDSUkvL1RSQU5TTElUIikKICAgIHN0cmluZyA8LSBzdWIoIi4qICIsICIiLCBzdHJpbmcpCgogICAgIyBzdHJpbmcgPC0gZ3N1YignW1s6cHVuY3Q6XV0nLCAnICcsIHN0cmluZykKCiAgICByZXR1cm4oc3RyaW5nKQp9CgpgYGAKCgoKIyMjIExvb3BpbmcgYWxnb3JpdGhtIGxvZ2ljIAoKYGBge3IsIGV2YWw9RkFMU0V9Cmxpc3Rfd29ya3MgPC0gc29jX2RhdGEkZGF0YSR3b3JrcwoKZGZfZWdvJFExLlcxIDwtIDAKZGZfZWdvJFExLlcyIDwtIDAKCmZvciAoaSBpbiAxOmxlbmd0aChsaXN0X3dvcmtzKSkgewoKICAgIHdhdmUxcyA8LSAyMDE1CiAgICB3YXZlMWUgPC0gMjAxOQogICAgd2F2ZTJzIDwtIDIwMjAKICAgIHdhdmUyZSA8LSAyMDI0CgogICAgd29ya3MgPC0gbGlzdF93b3Jrc1tbaV1dCgogICAgd29ya3MgPC0gd29ya3MgJT4lCiAgICAgICAgbGVmdF9qb2luKGRmX3ByZXNfMjQsIGJ5ID0gImlzc25fbCIsIG11bHRpcGxlID0gImFsbCIpCiAgICB3b3JrcyRgU0pSIFF1YXJ0aWxlYCA8LSBpZmVsc2UoaXMubmEod29ya3MkYFNKUiBRdWFydGlsZWApLCAiTm8gUmFuayIsIHdvcmtzJGBTSlIgUXVhcnRpbGVgKQoKICAgIGF1IDwtIHdvcmtzICU+JQogICAgICAgIHVubmVzdChhdXRob3IpICU+JQogICAgICAgIG11dGF0ZShjaGVja19pZCA9IGF1X2lkICVpbiUgZGZfZWdvJGF1X2lkKSAlPiUKICAgICAgICBtdXRhdGUoY2hlY2tfbmFtID0gc3RyX3N0cmlwKGF1X2Rpc3BsYXlfbmFtZSkgJWluJSBzdHJfc3RyaXAoZGZfZWdvJE5hYW0pKSAlPiUKICAgICAgICBmaWx0ZXIoY2hlY2tfaWQgPT0gVFJVRSAmIGNoZWNrX25hbSA9PSBUUlVFKQoKICAgIHdvcmtzIDwtIHdvcmtzICU+JQogICAgICAgIG11dGF0ZSh3YXZlcyA9IGNhc2Vfd2hlbihwdWJsaWNhdGlvbl95ZWFyID49IHdhdmUxcyAmIHB1YmxpY2F0aW9uX3llYXIgPD0gd2F2ZTFlIH4gIldhdmUgMSIsCiAgICAgICAgICAgIHB1YmxpY2F0aW9uX3llYXIgPj0gd2F2ZTJzICYgcHVibGljYXRpb25feWVhciA8PSB3YXZlMmUgfiAiV2F2ZSAyIiwgLmRlZmF1bHQgPSAiTkEiKSkgJT4lCiAgICAgICAgZmlsdGVyKHdhdmVzICE9ICJOQSIpCiAgICBpZiAobnJvdyh3b3JrcykgPT0gMCkgewoKICAgICAgICBuZXh0CgogICAgfSBlbHNlIHsKCiAgICAgICAgZm9yICh4IGluIDE6bnJvdyh3b3JrcykpIHsKCiAgICAgICAgICAgIGlmICh3b3JrcyR3YXZlc1t4XSA9PSAiV2F2ZSAxIikgewoKICAgICAgICAgICAgICAgIGlmICh3b3JrcyRgU0pSIFF1YXJ0aWxlYFt4XSA9PSAiUTEiKSB7CgogICAgICAgICAgICAgICAgICBuYWFtIDwtIHdvcmtzJGF1dGhvcltbeF1dJGF1X2Rpc3BsYXlfbmFtZQogICAgICAgICAgICAgICAgICBkZl9lZ29bc3RyX3N0cmlwKGRmX2VnbyROYWFtKSAlaW4lIHN0cl9zdHJpcChuYWFtKSwgXSRRMS5XMSA8LSBkZl9lZ29bc3RyX3N0cmlwKGRmX2VnbyROYWFtKSAlaW4lCiAgICAgICAgICAgICAgICAgICAgc3RyX3N0cmlwKG5hYW0pLCBdJFExLlcxICsgMQoKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKCiAgICAgICAgICAgICAgICBpZiAod29ya3MkYFNKUiBRdWFydGlsZWBbeF0gPT0gIlExIikgewoKICAgICAgICAgICAgICAgICAgbmFhbSA8LSB3b3JrcyRhdXRob3JbW3hdXSRhdV9kaXNwbGF5X25hbWUKICAgICAgICAgICAgICAgICAgZGZfZWdvW3N0cl9zdHJpcChkZl9lZ28kTmFhbSkgJWluJSBzdHJfc3RyaXAobmFhbSksIF0kUTEuVzIgPC0gZGZfZWdvW3N0cl9zdHJpcChkZl9lZ28kTmFhbSkgJWluJQogICAgICAgICAgICAgICAgICAgIHN0cl9zdHJpcChuYWFtKSwgXSRRMS5XMiArIDEKCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgfQoKICAgIH0KCn0KYGBgCgoKIyMjIENhcmVlciBhZ2UKCmBgYHtyLCBldmFsPUZBTFNFfQoKZGZfY2FyZWVyX2FnZSA8LSBkZl93b3JrcyAlPiUKICB1bm5lc3QoYXV0aG9yKSAlPiUgIyB1bm5lc3RpbmcgdGhlIHRpYmJsZSBmcm9tIHRoZSB0aWJibGUKICBmaWx0ZXIoYXVfaWQgJWluJSBkZl9lZ28kYXVfaWQgPT0gVFJVRSkgJT4lICMgYXV0aG9ycyBpbiBkZl93b3JrcyBzaG91bGQgbWF0Y2ggYXV0aG9ycyBpbiBkZl9lZ28KICBncm91cF9ieShhdV9pZCkgJT4lCiAgbXV0YXRlKG1pbl95ZWFyX3B1YiA9IG1pbihwdWJsaWNhdGlvbl95ZWFyLCBuYS5ybSA9IFRSVUUpLCAjIGluaXRpYWwgY2FsY3VsYXRpb24gb2YgbWluaW11bSB5ZWFyCiAgICAgICAgIGNvdW50X3B1YiA9IG4oKSkgJT4lICAjIGNvdW50IG51bWJlciBvZiBwdWJsaWNhdGlvbnMKICBtdXRhdGUoZmlyc3RfeWVhcl9wdWIgPSBpZmVsc2UoY291bnRfcHViID09IDEsIG1pbl95ZWFyX3B1YiwgIyBpZiBudW1iZXIgb2YgcHVibGljYXRpb25zIGlzIDEsIHNjb3JlIGlzIG1pbl95ZWFyX3B1YgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyX3llYXIgPSBwdWJsaWNhdGlvbl95ZWFyW3B1YmxpY2F0aW9uX3llYXIgIT0gbWluX3llYXJfcHViXSAjIGZpbHRlciBtaW5pbXVtIHllYXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZWFuX3B1YnllYXIgPSBtZWFuKGZpbHRlcl95ZWFyLCBuYS5ybSA9IFRSVUUpICMgY2FsY3VsYXRlIG1lYW4gd2l0aG91dCBtaW4gc2NvcmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWxpZF95ZWFyID0gbWluKGZpbHRlcl95ZWFyW2ZpbHRlcl95ZWFyID49IChtZWFuX3B1YnllYXIgLSAyNSldLCBuYS5ybSA9IFRSVUUpICMgbWluaW11bSB5ZWFyIC0+IHJhbmdlIG1lYW4tMjUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWxpZF95ZWFyICMgaWYgbnVtYmVyIG9mIHB1YmxpY2F0aW9ucyBpcyBub3QgMSwgdGhhbiBzY29yZSBtaW5pbXVtIHllYXIgd2l0aCBmaXJzdCB5ZWFyIHJlbW92ZWQgd2l0aGluIHJhbmdlIG1lYW4tMjUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpICU+JSAKICAKICAjIHRoaXMgbGluZSBjb3JyZWN0cyBmb3IgdGhlIHdhcm5pbmcgb2YgcmV0dXJuaW5nIGluZmluaXRlcyB0aGF0IGZvciBzb21lIHJlYXNvbiB3ZXJlIG5vdCBmaWx0ZXJlZCB0aHJvdWdoIHRoZSBmaXJzdCBpZmVsc2UgY29tbWFuZAogIG11dGF0ZShmaXJzdF95ZWFyX3B1YiA9IGlmZWxzZShpcy5pbmZpbml0ZShmaXJzdF95ZWFyX3B1YiksIG1pbl95ZWFyX3B1YiwgZmlyc3RfeWVhcl9wdWIpKSAlPiUgI2FkanVzdGluZyBpbmZpbml0ZSBzY29yZXMgdG8gbWluaW11bSB5ZWFyCiAgCiAgc2VsZWN0KGF1X2lkLCBmaXJzdF95ZWFyX3B1YikgJT4lICMgc2VsZWN0aW5nIHZhcmlhYmxlcwogIGRpc3RpbmN0KGF1X2lkLCBmaXJzdF95ZWFyX3B1YiwgLmtlZXBfYWxsID0gVFJVRSkgIyBtYWtpbmcgc3VyZSBvbmx5IGRpc3RpbmN0IGF1dGhvcnMgYXJlIGluIGRhdGEgZnJhbWUgIAogIAoKZGZfZWdvIDwtIGRmX2VnbyAlPiUgbGVmdF9qb2luKGRmX2NhcmVlcl9hZ2UsIGJ5ID0gImF1X2lkIikKCgpgYGAKCiMjIFByYWN0aWNpbmcgd2l0aCBSU2llbmEgd2l0aG91dCBwcmVzdGlnZQoKIyMjIG93biBmY29sbmV0LCBkaWZmZXJlbnQgZnJvbSBuaWVscwoKYGBge3IsIGV2YWw9RkFMU0V9CgpmY29sbmV0XzI1IDwtIGZ1bmN0aW9uKGRhdGEgPSBzY2hvbGFycywgdW5pdmVyc2l0eSA9ICJSVSIsIGRpc2NpcGxpbmUgPSAic29jaW9sb2d5Iiwgd2F2ZXMgPSBsaXN0KGMoMjAxNSwKICAgIDIwMTgpLCBjKDIwMTksIDIwMjMpKSwgdHlwZSA9IGMoImZpcnN0IikpIHsKCiAgICAjIHN0ZXAgMQogICAgZGVtb2dyYXBoaWNzIDwtIGRvLmNhbGwocmJpbmQuZGF0YS5mcmFtZSwgZGF0YSRkZW1vZ3JhcGhpY3MpCiAgICBkZW1vZ3JhcGhpY3MgPC0gZGVtb2dyYXBoaWNzICU+JQogICAgICAgIG11dGF0ZShVbml2ZXJzaXRlaXQxLjIyID0gcmVwbGFjZShVbml2ZXJzaXRlaXQxLjIyLCBpcy5uYShVbml2ZXJzaXRlaXQxLjIyKSwgIiIpLCBVbml2ZXJzaXRlaXQyLjIyID0gcmVwbGFjZShVbml2ZXJzaXRlaXQyLjIyLAogICAgICAgICAgICBpcy5uYShVbml2ZXJzaXRlaXQyLjIyKSwgIiIpLCBVbml2ZXJzaXRlaXQxLjI0ID0gcmVwbGFjZShVbml2ZXJzaXRlaXQxLjI0LCBpcy5uYShVbml2ZXJzaXRlaXQxLjI0KSwKICAgICAgICAgICAgIiIpLCBVbml2ZXJzaXRlaXQyLjI0ID0gcmVwbGFjZShVbml2ZXJzaXRlaXQyLjI0LCBpcy5uYShVbml2ZXJzaXRlaXQyLjI0KSwgIiIpLCBkaXNjaXBsaW5lLjIyID0gcmVwbGFjZShkaXNjaXBsaW5lLjIyLAogICAgICAgICAgICBpcy5uYShkaXNjaXBsaW5lLjIyKSwgIiIpLCBkaXNjaXBsaW5lLjI0ID0gcmVwbGFjZShkaXNjaXBsaW5lLjI0LCBpcy5uYShkaXNjaXBsaW5lLjI0KSwgIiIpKQoKICAgIHNhbXBsZSA8LSB3aGljaCgoZGVtb2dyYXBoaWNzJFVuaXZlcnNpdGVpdDEuMjIgJWluJSB1bml2ZXJzaXR5IHwgZGVtb2dyYXBoaWNzJFVuaXZlcnNpdGVpdDIuMjIgJWluJQogICAgICAgIHVuaXZlcnNpdHkgfCBkZW1vZ3JhcGhpY3MkVW5pdmVyc2l0ZWl0MS4yNCAlaW4lIHVuaXZlcnNpdHkgfCBkZW1vZ3JhcGhpY3MkVW5pdmVyc2l0ZWl0Mi4yNCAlaW4lCiAgICAgICAgdW5pdmVyc2l0eSkgJiAoZGVtb2dyYXBoaWNzJGRpc2NpcGxpbmUuMjIgJWluJSBkaXNjaXBsaW5lIHwgZGVtb2dyYXBoaWNzJGRpc2NpcGxpbmUuMjQgJWluJSBkaXNjaXBsaW5lKSkKCiAgICBkZW1vZ3JhcGhpY3Nfc29jIDwtIGRlbW9ncmFwaGljc1tzYW1wbGUsIF0KICAgIHNjaG9sYXJzX3NlbCA8LSBsYXBwbHkoc2Nob2xhcnMsICJbIiwgc2FtcGxlKQoKICAgICMgc3RlcCAyCiAgICBpZHMgPC0gZGVtb2dyYXBoaWNzX3NvYyRhdV9pZAogICAgbndhdmVzIDwtIGxlbmd0aCh3YXZlcykKICAgIG5ldHMgPC0gYXJyYXkoMCwgZGltID0gYyhud2F2ZXMsIGxlbmd0aChpZHMpLCBsZW5ndGgoaWRzKSksIGRpbW5hbWVzID0gbGlzdCh3YXZlID0gMTpud2F2ZXMsIGlkcywKICAgICAgICBpZHMpKQogICAgZGltbmFtZXMobmV0cykKCiAgICAjIHN0ZXAgMwogICAgZGZfd29ya3MgPC0gdGliYmxlKHdvcmtzX2lkID0gdW5saXN0KGxhcHBseShzY2hvbGFyc19zZWwkd29yaywgZnVuY3Rpb24obCkgbCRpZCkpLCB3b3Jrc19hdXRob3IgPSB1bmxpc3QobGFwcGx5KHNjaG9sYXJzX3NlbCR3b3JrLAogICAgICAgIGZ1bmN0aW9uKGwpIGwkYXV0aG9yKSwgcmVjdXJzaXZlID0gRkFMU0UpLCB3b3Jrc195ZWFyID0gdW5saXN0KGxhcHBseShzY2hvbGFyc19zZWwkd29yaywgZnVuY3Rpb24obCkgbCRwdWJsaWNhdGlvbl95ZWFyKSwKICAgICAgICByZWN1cnNpdmUgPSBGQUxTRSkpCgogICAgZGZfd29ya3MgPC0gZGZfd29ya3NbIWR1cGxpY2F0ZWQoZGZfd29ya3MpLCBdCgogICAgIyBzdGVwIDQKICAgIGlmICh0eXBlID09ICJmaXJzdCIpIHsKICAgICAgICBmb3IgKGogaW4gMTpud2F2ZXMpIHsKICAgICAgICAgICAgZGZfd29ya3NfdyA8LSBkZl93b3Jrc1tkZl93b3JrcyR3b3Jrc195ZWFyID49IHdhdmVzW1tqXV1bMV0gJiBkZl93b3JrcyR3b3Jrc195ZWFyIDw9IHdhdmVzW1tqXV1bMl0sCiAgICAgICAgICAgICAgICBdCiAgICAgICAgICAgIGZvciAoaSBpbiAxOm5yb3coZGZfd29ya3NfdykpIHsKICAgICAgICAgICAgICAgIGVnbyA8LSBkZl93b3Jrc193JHdvcmtzX2F1dGhvcltpXVtbMV1dJGF1X2lkWzFdCiAgICAgICAgICAgICAgICBhbHRlcnMgPC0gZGZfd29ya3NfdyR3b3Jrc19hdXRob3JbaV1bWzFdXSRhdV9pZFstMV0KICAgICAgICAgICAgICAgIGlmIChzdW0oaWRzICVpbiUgZWdvKSA+IDAgJiBzdW0oaWRzICVpbiUgYWx0ZXJzKSA+IDApIHsKICAgICAgICAgICAgICAgICAgbmV0c1tqLCB3aGljaChpZHMgJWluJSBlZ28pLCB3aGljaChpZHMgJWluJSBhbHRlcnMpXSA8LSAxCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgaWYgKHR5cGUgPT0gImxhc3QiKSB7CiAgICAgICAgZm9yIChqIGluIDE6bndhdmVzKSB7CiAgICAgICAgICAgIGRmX3dvcmtzX3cgPC0gZGZfd29ya3NbZGZfd29ya3Mkd29ya3NfeWVhciA+PSB3YXZlc1tbal1dWzFdICYgZGZfd29ya3Mkd29ya3NfeWVhciA8PSB3YXZlc1tbal1dWzJdLAogICAgICAgICAgICAgICAgXQogICAgICAgICAgICBmb3IgKGkgaW4gMTpucm93KGRmX3dvcmtzX3cpKSB7CiAgICAgICAgICAgICAgICBlZ28gPC0gcmV2KGRmX3dvcmtzX3ckd29ya3NfYXV0aG9yW2ldW1sxXV0kYXVfaWQpWzFdCiAgICAgICAgICAgICAgICBhbHRlcnMgPC0gcmV2KGRmX3dvcmtzX3ckd29ya3NfYXV0aG9yW2ldW1sxXV0kYXVfaWQpWy0xXQogICAgICAgICAgICAgICAgaWYgKHN1bShpZHMgJWluJSBlZ28pID4gMCAmIHN1bShpZHMgJWluJSBhbHRlcnMpID4gMCkgewogICAgICAgICAgICAgICAgICBuZXRzW2osIHdoaWNoKGlkcyAlaW4lIGVnbyksIHdoaWNoKGlkcyAlaW4lIGFsdGVycyldIDwtIDEKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBpZiAodHlwZSA9PSAiYWxsIikgewogICAgICAgIGZvciAoaiBpbiAxOm53YXZlcykgewogICAgICAgICAgICBkZl93b3Jrc193IDwtIGRmX3dvcmtzW2RmX3dvcmtzJHdvcmtzX3llYXIgPj0gd2F2ZXNbW2pdXVsxXSAmIGRmX3dvcmtzJHdvcmtzX3llYXIgPD0gd2F2ZXNbW2pdXVsyXSwKICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgZm9yIChpIGluIDE6bnJvdyhkZl93b3Jrc193KSkgewogICAgICAgICAgICAgICAgZWdvcyA8LSBkZl93b3Jrc193JHdvcmtzX2F1dGhvcltpXVtbMV1dJGF1X2lkCiAgICAgICAgICAgICAgICBpZiAoc3VtKGlkcyAlaW4lIGVnb3MpID4gMCkgewogICAgICAgICAgICAgICAgICBuZXRzW2osIHdoaWNoKGlkcyAlaW4lIGVnb3MpLCB3aGljaChpZHMgJWluJSBlZ29zKV0gPC0gMQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgb3V0cHV0IDwtIGxpc3QoKQogICAgb3V0cHV0JGRhdGEgPC0gc2Nob2xhcnNfc2VsCiAgICBvdXRwdXQkbmV0cyA8LSBuZXRzCiAgICByZXR1cm4ob3V0cHV0KQp9CgpgYGAKCgpgYGB7ciwgZXZhbD1GQUxTRX0KCiMgc29jX3Rlc3RfZGF0YSA8LSBzaWVuYURhdGFDcmVhdGUod2F2ZTEsIHdhdmUyKQoKc29jX3Rlc3RfZGF0YSA8LSBzaWVuYURlcGVuZGVudChhcnJheShjKHdhdmUxLCB3YXZlMiksIGRpbSA9IGMoMzg2LCAzODYpKSkKYGBgCgpUcnlpbmcgdG8gZ2V0IGEgbmV0d29yayBmb3IgUlNpZW5hCgpgYGB7ciwgZXZhbD1GQUxTRX0KdGVzdF9SVSA8LSBmY29sbmV0XzI1KGRhdGEgPSBzY2hvbGFycywgCiAgICAgICAgICAgICAgICAgICAgdW5pdmVyc2l0eSA9ICJSVSIsCiAgICAgICAgICAgICAgICAgICAgZGlzY2lwbGluZSA9ICJzb2Npb2xvZ3kiLCAKICAgICAgICAgICAgICAgICAgICB3YXZlcyA9IGxpc3QoYygyMDE1LCAyMDE4KSwgYygyMDE5LCAyMDIzKSksIAogICAgICAgICAgICAgICAgICAgIHR5cGUgPSBjKCJmaXJzdCIpKQoKdGVzdF9VdlQgPC0gZmNvbG5ldF8yNShkYXRhID0gc2Nob2xhcnMsIAogICAgICAgICAgICAgICAgICAgIHVuaXZlcnNpdHkgPSAiVXZUIiwKICAgICAgICAgICAgICAgICAgICBkaXNjaXBsaW5lID0gInNvY2lvbG9neSIsIAogICAgICAgICAgICAgICAgICAgIHdhdmVzID0gbGlzdChjKDIwMTUsIDIwMTgpLCBjKDIwMTksIDIwMjMpKSwgCiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IGMoImZpcnN0IikpCgpzb2NfdGVzdF9kYXRhIDwtIHNpZW5hRGF0YUNyZWF0ZSh0ZXN0X1JVLCB0ZXN0X1V2VCkKCnNvY190ZXN0X2RhdGEgPC0gc2llbmFEZXBlbmRlbnQoYXJyYXkoYyh0ZXN0X1JVLCB0ZXN0X1V2VCwgZGltID0gYygzODYsIDM4NikpKQoKYGBgCgotLS0tCiMgVHdvIGFydGljbGVzCgpXZSBoYWQgdG8gc2VuZCBpbiB0d28gYXJ0aWNsZXMgYmVmb3JlIGNsYXNzLiAKCgpIYW5jZWFuIGV0IGFsLiAoMjAxNCkgaXMgYWJvdXQgY29sbGFib3JhdGlvbiBuZXR3b3JrcyBhY3Jvc3MgdGhlIDE3IFJvbWFuaWFuIHNvY2lvbG9neSBkZXBhcnRtZW50cy4gSSBmb3VuZCB0aGUgdGhlb3JldGljYWwgc2VjdGlvbiB1c2VmdWwsIGFzIGl0IGxpc3RlZCBwcmV2aW91cyBlbXBpcmljYWwgZmluZGluZ3Mgb2YgY29sbGFib3JhdGlvbiBuZXR3b3JrIHN0cnVjdHVyZXMsIEkgYmVsaWV2ZSBzcGVjaWZpY2FsbHkgaW4gc29jaW9sb2d5LiBUaGUgZmlyc3Qgb25lLCBzbWFsbC13b3JsZCBuZXR3b3JrcyB3ZXJlIG1vcmUgb2Z0ZW4gZm91bmQgaW4gY3Jvc3MtZGlzY2lwbGluYXJ5IGNvbGxhYm9yYXRpb25zLiAiQ29sbGFib3JhdGlvbiBuZXR3b3JrcyB0aGF0IGZpdCBzbWFsbC13b3JsZCBtb2RlbHMgYXJlIGV4cGVjdGVkIHRvIGhhdmUgbWFueSBkaXN0aW5jdCBjbHVzdGVycyBvZiByZXNlYXJjaGVycyBpbnZlc3RpZ2F0aW5nIHNwZWNpZmljIHN1YmplY3RzIG9yIGltcGxlbWVudGluZyBwYXJ0aWN1bGFyIHJlc2VhcmNoIHByb2plY3RzLCB3aGlsZSB0aGUgZ2VvZGVzaWNzIGFtb25nIHRoZXNlIGNsdXN0ZXJzIGFyZSBzbWFsbCAobG93IG51bWJlciBvZiBsaW5rcyBvciBkZWdyZWUgb2Ygc2VwYXJhdGlvbikiIChIYW5jZWFuIGV0IGFsLiwgMjAxNCwgMikuIFRoZSBzZWNvbmQgb25lIHNlZW1zIHRoZSBtb3N0IHJlbGV2YW50IHRvIG1lLCB0aGUgKipwcmluY2lwbGUgb2YgcHJlZmVyZW50aWFsIGF0dGFjaG1lbnQqKi4gIk5ldyBsaW5rcyBhbmQgbm9kZXMgYXJlIG5vdCByYW5kb21seSBjb25uZWN0ZWQgdG8gbGFyZ2UgbmV0d29ya3MsIGJ1dCBiYXNlZCBvbiBvYnNlcnZlZCBwb3dlci1sYXcgZGlzdHJpYnV0aW9ucyIsIE1hdHRoZXctZWZmZWN0OiBzY2llbnRpZmljIGZpZWxkcyBncm93IGFuZCBkZXZlbG9wIGFyb3VuZCBoaWdobHkgcHJlc3RpZ2lvdXMgc2NpZW50aWZpYyBzY2hvbGFycy4gVGhpcmRseSwgbmV0d29ya3MgZGVmaW5lZCBieSBzdHJ1Y3R1cmFsIGNvaGVzaW9uLCB3aGljaCBhcmUgZGVuc2VseSBjb25uZWN0ZWQsIHdpdGggbm8gdnVsbmVyYWJpbGl0aWVzIGZvciBmcmFnbWVudGF0aW9uLiBGaW5hbGx5LCB0aGUgY29yZS1wZXJpcGhlcnkgbW9kZWwgaXMgZGVmaW5lZCBhcyAibmV0d29ya3MgY29uc2lzdGluZyBvZiBvbmUgZ3JvdXAgKHRoZSBjb3JlKSB0byB3aGljaCBhbGwgYWN0b3JzIGJlbG9uZyB0byBhIGdyZWF0ZXIgb3IgbGVzc2VyIGV4dGVudCIuIAoKCktub2tlIGFuZCBZYW5nICgyMDExKSBleHBsYWluZWQgaG93IHByZXN0aWdlIHdvcmtzIGluIHNvY2lhbCBuZXR3b3JrcywgdGhhdCBhbiBlZ28gcmVjZWl2ZXMgbXVjaCBsZXNzIHRpZXMgdGhhdCB0aGV5IHJlY2VpdmUuICAKLS0tLQoK</div>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("lab6.Rmd");
  window.initializeCodeFolding("show" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
